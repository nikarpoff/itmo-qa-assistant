# S.T.A.L.K.E.R. RAG System
Чат-бот по вселенной игры "Сталкер" с использованием подхода RAG.

------
### Stack:
- LangChain
- qDrant
- Transformers
- PyTorch

### Instruments:
- Docker
- ru-en-RoSBERTa
- GigaChat
- OpenAI

### Resources:
- [S.T.A.L.K.E.R. Wiki: Zone Chronicles](https://stalker.fandom.com/ru/wiki/)


------

### Подготовка к локальному использованию
1. Склонируйте репозиторий и перейдите в директорию
```
git clone https://github.com/nikarpoff/stalker-rag-system
cd stalker-rag-system
```
2. Установите зависимости
```
pip install -r requirements.txt
```
3. Инициализируйте базу данных qDrant. Вы можете использовать образ Docker:
```
docker compose up -d
```
Или использовать свой инстанс БД (тогда придется изменить DATABASE_CONNECTION_URL в .env и (опционально) COLLECTION_NAME в config.py).
4. Создайте .env в корневой директории проекта и запишите туда адрес вашей БД и ваши API-ключи для сервисов, которые планируете использовать, например:
```
DATABASE_CONNECTION_URL="http://localhost:6333"

SBER_API_KEY="?"
SBER_SCOPE="?"

DEEPSEEK_API_KEY="?"
```

Учтите, что для использования API GigaChat может потребоваться сертификат МинЦифры (его необходимо разместить в корневую директорию проекта с именем russian_trusted_root_ca.cer).
5. Если хотите обновить состояние базы знаний и загрузить WIKI заново, используйте скрипт wikiload.py (опционально):
```
python3 wikiload.py
```

6. Для векторизации статей и записи их в БД запустите скрипт filldb.py (процесс может занять продолжительное время). При желании Вы можете поменять размер чанков в config.py и параметры очистки текста в utils.py.
```
python3 filldb.py
```


Всё готово к использованию!

### Примеры использования
1. Поиск документов. Кроме поиска, который реализован в dashboard qDrant можно использовать скрипт search.py с указанием позиционного аргумента query:
```
python3 search.py "Кто такие бандиты?"
```


Пример результата:
```
Query: Кто такие бандиты?

Result 1:
Title: Бандиты
Score: 0.7059
Content: — представители криминального мира на территории зоны отчуждения. одна из самых многочисленных группировок зоны...

Result 2:
Title: Бандиты
Score: 0.6858
Content: бандиты-новички носят куртки со вшитыми броневыми элементами, более опытные преступники и лидеры банд надевают кожаные плащи. такая одежда выполняет у бандитов роль показателя принадлежности к криминальному миру...

Result 3:
Title: Бандиты-грабители
Score: 0.6504
Content: бандиты-грабители — семь идентичных друг другу ролей в "s.t.a.l.k.e.r.: чистое небо"...
```

Параметры поиска можно изменить в скрипте search.py.

2. Использование LLM для ответов на вопросы. Для этого необходимо использовать скрипт answer.py с указанием следующих аргументов:
    - позиционный аргумент question - вопрос к модели
    - ключевой аргумент --model_type - модель (доступны: local - любая LLM, загружаемая с Hugging Face; gigachat-remote - API GigaChat; deepseek-remote - API DeepSeek)
    - ключевой опциональный аргумент --model_name - название модели (в случае --model_type=local это название модели с HF; для --model_type=gigachat-remote на момент написания доступны GigaChat/GigaChat-Pro/GigaChat-Max)
    - ключевой оприональный аргумент --role - роль LLM. По-умолчанию --role=default, можно указать --role=bandit

----
**Скриншоты следующих запросов можно найти в директории examples**

-----

Примеры использования:
```
python answer.py "А что такое Исполнитель Желаний?" --model_type=gigachat-remote --role=bandit
```

> Question: А что такое Исполнитель Желаний?

> Answer: Исполнитель желаний, братишка, это типа монолит такой, шоб рассказывали сталкеры всякое разное. Это пси-установка в самом сердце ЧАЭС, под саркофагом сидит. Говорят, шо никто оттуда живой не возвращался, ибо якобы там всех косит или желания исполняются так, шо лучше б вообще в себя не верить. Короче, это такая штуковина, шо люди ходят молятся ей, хотят чтоб всё тип-топ стало, ан нет, обычно хана потом приходит.



```
python answer.py "А что такое Исполнитель Желаний?" --model_type=gigachat-remote
```

> Question: А что такое Исполнитель Желаний?

> Answer: Исполнитель Желаний (или Монолит) — это мистический объект в центре Зоны, расположенный под саркофагом четвертого энергоблока Чернобыльской АЭС. В играх серии S.T.A.L.K.E.R. он представлен как культовый артефакт, вокруг которого сложилось множество легенд среди сталкеров. По преданию, посетив Монолит и загадав желание, человек обретает исполнение своего желания, однако истинная природа происходящего остаётся загадкой даже для самих сталкеров.

> Впервые подробно Монолит раскрывается в игре «S.T.A.L.K.E.R.: Тень Чернобыля», где игроку предстоит встретиться с ним лично, разгадать тайны объекта и сделать судьбоносный выбор между получением желаемого и поиском скрытой двери, ведущей к дальнейшим открытиям Зоны.



Использование GigaChat-Max повышает креативность модели, но плохо влияет на точность следования инструкциям. В примере ниже LLM немного адаптировала анекдот.
```
python answer.py "Расскажи свой любимый анекдот из сталкера" --model_type=gigachat-remote --model_name=GigaChat-Max
```


> Question: Расскажи свой любимый анекдот из сталкера

> Answer: Мой любимый анекдот из мира S.T.A.L.K.E.R.:

> Встречает сталкер своего старого друга. А тот весь помятый, с синяком под глазом. Сталкер удивляется:

> — Петя, что с тобой случилось?

> Друг грустно вздыхает:

> — Да напали, побили, деньги отобрали...

> Сталкер сочувствует:

> — Хоть запомнил тех, кто обидел?

> А друг усмехается:

> — Зачем запоминать... Это жена была!


При использовании GigaChat-Pro LLM реже придумывает факты и более строго следует системному промпту. В примере ниже LLM точно процитировала анекдот.
```
python answer.py "Расскажи свой любимый анекдот из сталкера" --model_type=gigachat-remote --model_name=GigaChat-Pro
```

> Question: Расскажи свой любимый анекдот из сталкера

> Answer: Мой любимый анекдот из вселенной S.T.A.L.K.E.R.:

> «Пришел, значит, сталкер к доктору. Доктор осмотрел его и говорит:

> — Вот это — от усталости, это — от нервного напряжения, а это — от депрессии.

> — Спасибо, доктор. Скажите, а у вас кроме водки ничего нет?»

>Этот анекдот хорошо отражает реалии жизни сталкеров в Зоне, где даже лечение порой сводится к простому, но проверенному средству — водке.


Если в БД нет ответа, то модель прямо об этом говорит:
```
python answer.py "Почему Сахаров не узнал Стрелка в Тенях Чернобыля?" --model_type=gigachat-remote --role=bandit --model_name=GigaChat-Max
```

> Question: Почему Сахаров не узнал Стрелка в Тенях Чернобыля?

> Answer: Маслёнок, тут чёткая вещь такая: почему Сахаров не признал Стрелка в "Тени Чернобыля"? В играх об этом чёткого объяснения нет, типа забыли сценаристы про прошлую встречу. Так что братишка, не парься особо!

```
python answer.py "Правда ли, что монолит дружит с мутанатами" --model_type=gigachat-remote --model_name=GigaChat --role=bandit
```


> Question: Правда ли, что монолит дружит с мутанатами

> Answer: Не ну ты внатуре загнул, чё попроще спроси, а? Монолит типа вообще с кем-нибудь дружит? Да ничё подобного! Эти ребята исключительно сами по себе ходят, друг друга уважают и никого чужого близко не подпускают. Ну разве что мёртвых сталкеров, типа зомбированных, они почитают как обращённых пацанов. Но живым не доверяют никак, стрелять первым делом норовят. Так шо, братишка, толком дружбы никакой нет, чисто показуха.


```
python answer.py "Правда ли, что монолит дружит с мутанатами" --model_type=gigachat-remote --model_name=GigaChat
```

> Question: Правда ли, что монолит дружит с мутанатами

> Answer: Нет, монолит не дружит с мутантами. В играх серии S.T.A.L.K.E.R. монолит считается враждебной группировкой ко всем другим сталкерам и даже относится с подозрением к зомбированным сталкерам, которых воспринимает как "обращенных". Мутанты, являясь частью аномальной активности Зоны, воспринимаются монолитовцами скорее как угроза, нежели союзники. Такая позиция монолитовцев отражена в игровом процессе, где они активно противостоят мутантам и любым сталкерам, представляющим угрозу для их целей.

> Источник: «S.T.A.L.K.E.R.: Тень Чернобыля», «S.T.A.L.K.E.R. 2: Сердце Чернобыля».


### Контакты
Никита Карпов, @karpoffN - Telegram